<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>CHN LNK Migration</title>
</head>
<body>
<script>
const fixedKeys = [
  'clMysteryLetter', 'clwordtwo', 'monthcl_lastMonth', 'clcorrect',
  'cldisabledkey', 'cldynamiteUsedThisRound', 'consocount', 'clguesscnt',
  'clwordone', 'clstarscnt', 'clBuildVersion', 'clwordfour', 'monthwins',
  'clwordfive', 'starcl1count', 'starcl5count', 'monthclstars', 'vowelcount',
  'clshowrules', 'totalclwins', 'clgamecnt', 'playerName', 'clshowalert',
  'clhardmode', 'clwordlast', 'gameclwon', 'starclxcount', 'vowelactive',
  'clwordsix', 'cllivescnt', 'totalclplayed', 'cllives', 'starcl4count',
  'monthclplayed', 'totalclstars', 'starcl3count', 'clMysteryActive',
  'clgamestarted', 'cldynamite', 'starcl0count', 'totalclstreak',
  'starcl2count', 'clwordthree'
];

const prefixes = [
  'gameovercl',
  'gamestatcl',
  'archstatcl',
  'archovercl'
];

window.addEventListener("load", () => {
  const data = {};

  // Copy fixed keys
  fixedKeys.forEach(key => {
    const value = localStorage.getItem(key);
    if (value !== null) {
      data[key] = value;
	  console.log("in fixed keys");
    }
  });

  // Copy dynamic prefix keys
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (prefixes.some(prefix => key.startsWith(prefix))) {
      data[key] = localStorage.getItem(key);
	  console.log("in dynamic keys");
    }
  }

  // Determine opener origin safely
  const targetOrigin = window.opener ? window.opener.origin : "*";

  // Send data back to opener
  console.log("Popup sending message to opener...");
  window.opener.postMessage(
    { type: "LOCALSTORAGE_MIGRATION", payload: JSON.stringify(data) },
    targetOrigin
  );

  // Close popup
 // window.close();
});
</script>
</body>
</html>
