<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>CHN LNK Migration</title>
</head>
<body>
<script>
const fixedKeys = [
  'clMysteryLetter','clwordtwo','monthcl_lastMonth','clcorrect',
  'cldisabledkey','cldynamiteUsedThisRound','consocount','clguesscnt',
  'clwordone','clstarscnt','clBuildVersion','clwordfour','monthwins',
  'clwordfive','starcl1count','starcl5count','monthclstars','vowelcount',
  'clshowrules','totalclwins','clgamecnt','playerName','clshowalert',
  'clhardmode','clwordlast','gameclwon','starclxcount','vowelactive',
  'clwordsix','cllivescnt','totalclplayed','cllives','starcl4count',
  'monthclplayed','totalclstars','starcl3count','clMysteryActive',
  'clgamestarted','cldynamite','starcl0count','totalclstreak',
  'starcl2count','clwordthree','skipReloadOnce',
  'cldynamiteTutorialShown','cltradeoffered'
];

const prefixes = [
  'gameovercl',
  'gamestatcl',
  'archstatcl',
  'archovercl'
];

window.addEventListener("load", () => {
  const data = {};

  // Copy fixed keys
  fixedKeys.forEach(key => {
    const value = localStorage.getItem(key);
    if (value !== null) data[key] = value;
  });

  // Copy dynamic prefix keys
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (prefixes.some(prefix => key.startsWith(prefix))) {
      data[key] = localStorage.getItem(key);
    }
  }

  // Send to opener; receiver validates origin
	window.opener.postMessage(
	  { type: "LOCALSTORAGE_MIGRATION", payload: JSON.stringify(data) },
	  "https://thechnlnk.com"
	);
	
  window.close();
});
</script>
</body>
</html>
